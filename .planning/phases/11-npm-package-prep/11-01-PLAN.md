---
phase: 11-npm-package-prep
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - LICENSE
autonomous: true

must_haves:
  truths:
    - "npm pack --dry-run shows only dist/, package.json, README.md, LICENSE"
    - "npm link && screenie --help works from any directory"
    - "LICENSE file is MIT and matches package.json license field"
    - "package.json has repository, bugs, homepage pointing to correct URLs"
  artifacts:
    - path: "package.json"
      provides: "Package metadata for npm publishing"
      contains: '"name": "screenie"'
    - path: "LICENSE"
      provides: "MIT license for open source distribution"
      contains: "MIT License"
  key_links:
    - from: "package.json"
      to: "dist/cli.js"
      via: "bin field"
      pattern: '"screenie":\\s*"\\./dist/cli\\.js"'
    - from: "package.json"
      to: "LICENSE"
      via: "license field matching file"
      pattern: '"license":\\s*"MIT"'
---

<objective>
Configure package.json for npm publishing and create MIT LICENSE file.

Purpose: Enable public npm release with proper metadata, security (files whitelist), and licensing.
Output: Package ready for `npm publish` with correct name, repository links, and license.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-npm-package-prep/11-RESEARCH.md

@package.json
@tsup.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update package.json for npm publishing</name>
  <files>package.json</files>
  <action>
Update package.json with the following changes:

1. Rename package: `"name": "screenie"`

2. Update bin entry to match package name:
   ```json
   "bin": {
     "screenie": "./dist/cli.js"
   }
   ```

3. Add files whitelist (security - only publish compiled code):
   ```json
   "files": [
     "dist"
   ]
   ```

4. Add repository field:
   ```json
   "repository": {
     "type": "git",
     "url": "git+https://github.com/memehalis/screenie.git"
   }
   ```

5. Add bugs field:
   ```json
   "bugs": {
     "url": "https://github.com/memehalis/screenie/issues"
   }
   ```

6. Add homepage field:
   ```json
   "homepage": "https://screenie.xyz"
   ```

7. Add author field:
   ```json
   "author": "memehalis"
   ```

8. Update keywords to include "screenie":
   ```json
   "keywords": [
     "screenie",
     "responsive",
     "screenshot",
     "playwright",
     "cli",
     "design",
     "testing"
   ]
   ```

9. Add prepublishOnly script (build + test before publish):
   ```json
   "prepublishOnly": "npm run build && npm run test"
   ```

Keep all existing fields (dependencies, devDependencies, engines, scripts, etc.) unchanged.
  </action>
  <verify>
Run: `node -e "const pkg = require('./package.json'); console.log(pkg.name, pkg.bin, pkg.files, pkg.repository, pkg.bugs, pkg.homepage)"`
Expected: Shows "screenie", bin object with screenie key, files array with "dist", repository/bugs/homepage objects
  </verify>
  <done>
- package.json name is "screenie"
- bin entry is { "screenie": "./dist/cli.js" }
- files array is ["dist"]
- repository points to github.com/memehalis/screenie
- bugs points to github.com/memehalis/screenie/issues
- homepage is https://screenie.xyz
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MIT LICENSE file</name>
  <files>LICENSE</files>
  <action>
Create LICENSE file in repository root with standard MIT license text.

Use the exact SPDX MIT template from choosealicense.com:

```
MIT License

Copyright (c) 2026 memehalis

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

Note: Use 2026 as the copyright year (current year based on project context).
  </action>
  <verify>
Run: `head -3 LICENSE && grep -c "MIT License" LICENSE`
Expected: Shows "MIT License", copyright line, and count of 1
  </verify>
  <done>
- LICENSE file exists in repository root
- Contains "MIT License" header
- Contains copyright notice with year 2026 and author memehalis
- Contains full MIT license text
  </done>
</task>

<task type="auto">
  <name>Task 3: Build and verify package contents</name>
  <files></files>
  <action>
Build the project and verify npm pack output shows only intended files.

1. Run build:
   ```bash
   npm run build
   ```

2. Run npm pack dry-run:
   ```bash
   npm pack --dry-run 2>&1
   ```

3. Verify the output shows ONLY these files:
   - dist/cli.js (compiled CLI)
   - dist/cli.d.ts (TypeScript declarations)
   - LICENSE
   - package.json (automatic)
   - README.md (if exists - automatic)

4. Verify these files are NOT included:
   - No .env files
   - No .planning/ directory
   - No src/ directory
   - No scripts/ directory
   - No screenshots/ directory
   - No source maps (.map files)

If unexpected files appear, investigate why and report - but do NOT modify files field without understanding the issue.
  </action>
  <verify>
Run: `npm pack --dry-run 2>&1 | grep -E "^npm notice.*[0-9]+(kB|B)" | wc -l`
Expected: Should show ~4-6 files (dist/cli.js, dist/cli.d.ts, LICENSE, package.json, README.md if exists)

Run: `npm pack --dry-run 2>&1 | grep -E "\\.env|planning|src/|scripts/" | wc -l`
Expected: 0 (no sensitive files)
  </verify>
  <done>
- npm run build succeeds without errors
- npm pack --dry-run shows only: dist/, LICENSE, package.json, (README.md if exists)
- No .env, .planning, src, scripts, or other sensitive files in pack output
  </done>
</task>

<task type="auto">
  <name>Task 4: Test npm link and screenie command</name>
  <files></files>
  <action>
Test that the package installs correctly and the screenie command works.

1. Link the package globally:
   ```bash
   npm link
   ```

2. Test the screenie command from a different directory:
   ```bash
   cd /tmp && screenie --help
   ```

3. Verify the help output shows:
   - Command name references screenie (not responsive-capture)
   - Usage instructions are displayed
   - Options are listed

4. Clean up:
   ```bash
   npm unlink -g screenie
   ```

Note: npm link ignores the files field and links the entire project directory. This test verifies the bin entry works correctly. The npm pack test (Task 3) verifies file inclusion.
  </action>
  <verify>
Run: `cd /tmp && screenie --help 2>&1 | head -5`
Expected: Shows help text with usage information
  </verify>
  <done>
- npm link succeeds without errors
- screenie --help works from /tmp (outside project directory)
- Help output displays correctly
- npm unlink cleans up successfully
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify phase success criteria:

1. **Files whitelist works:**
   ```bash
   npm pack --dry-run 2>&1 | grep -E "planning|\.env|src/" | wc -l
   # Expected: 0
   ```

2. **Command works globally:**
   ```bash
   npm link && cd /tmp && screenie --help && cd - && npm unlink -g screenie
   # Expected: Help text displays
   ```

3. **License matches:**
   ```bash
   grep "MIT" LICENSE && grep '"license": "MIT"' package.json
   # Expected: Both match
   ```

4. **URLs correct:**
   ```bash
   grep -E "(repository|bugs|homepage)" package.json
   # Expected: Shows github.com/memehalis/screenie and screenie.xyz
   ```
</verification>

<success_criteria>
- [ ] package.json name is "screenie"
- [ ] package.json bin is { "screenie": "./dist/cli.js" }
- [ ] package.json files is ["dist"]
- [ ] package.json has repository, bugs, homepage fields
- [ ] LICENSE file exists with MIT license text
- [ ] npm pack --dry-run shows only intended files
- [ ] npm link && screenie --help works
</success_criteria>

<output>
After completion, create `.planning/phases/11-npm-package-prep/11-01-SUMMARY.md`
</output>
