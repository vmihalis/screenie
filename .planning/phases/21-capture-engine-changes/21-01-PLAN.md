---
phase: 21-capture-engine-changes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/engine/types.ts
  - src/cli/types.ts
  - src/cli/commands.ts
autonomous: true

must_haves:
  truths:
    - "CLIOptions interface accepts fullPage boolean"
    - "CaptureOptions interface accepts fullPage boolean"
    - "CLI parses --full-page flag as boolean"
  artifacts:
    - path: "src/engine/types.ts"
      provides: "CaptureOptions.fullPage property"
      contains: "fullPage?: boolean"
    - path: "src/cli/types.ts"
      provides: "CLIOptions.fullPage property"
      contains: "fullPage?: boolean"
    - path: "src/cli/commands.ts"
      provides: "--full-page CLI option"
      contains: "--full-page"
  key_links:
    - from: "src/cli/commands.ts"
      to: "Commander opts()"
      via: ".option() method"
      pattern: "option.*--full-page"
---

<objective>
Add type definitions and CLI flag for viewport vs full-page capture mode.

Purpose: Establish the type system and CLI interface for the new --full-page flag before modifying capture behavior.
Output: Updated types (CaptureOptions, CLIOptions) and CLI flag definition ready for implementation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-capture-engine-changes/21-RESEARCH.md

@src/engine/types.ts
@src/cli/types.ts
@src/cli/commands.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add fullPage to type definitions</name>
  <files>src/engine/types.ts, src/cli/types.ts</files>
  <action>
Add `fullPage?: boolean` property to both interfaces:

1. In `src/engine/types.ts`, add to `CaptureOptions` interface (after `hideCookieBanners`):
   ```typescript
   /** Capture full scrollable page instead of viewport-only (default: false) */
   fullPage?: boolean;
   ```

2. In `src/cli/types.ts`, add to `CLIOptions` interface (after `open`):
   ```typescript
   /** Capture full scrollable page instead of viewport-only */
   fullPage?: boolean;
   ```

Both are optional booleans. Engine defaults to false (viewport-only). CLI passes undefined when flag not specified.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Both CaptureOptions and CLIOptions have fullPage?: boolean property with JSDoc comments</done>
</task>

<task type="auto">
  <name>Task 2: Add --full-page CLI flag</name>
  <files>src/cli/commands.ts</files>
  <action>
Add the `--full-page` flag to the Commander program definition:

1. Add option after the `--no-open` option (before `.addHelpText`):
   ```typescript
   // Capture mode
   .option('--full-page', 'Capture full scrollable page instead of viewport-only')
   ```

2. Add example to the help text examples section:
   ```typescript
   $ screenie http://localhost:3000 --full-page  # Capture entire scrollable page
   ```
   Add this line after the existing `--no-open` example.

This is a boolean flag with no value argument. When present, `program.opts().fullPage` is `true`. When absent, it's `undefined` (falsy).
  </action>
  <verify>
Run test: `npm test -- --grep "full-page" --reporter=verbose` (will fail until test added, but parsing should work)
Manual check: `npx tsx src/cli/index.ts --help` shows --full-page option
  </verify>
  <done>--full-page flag appears in help output and parses correctly</done>
</task>

<task type="auto">
  <name>Task 3: Add CLI flag parsing test</name>
  <files>src/cli/__tests__/commands.test.ts</files>
  <action>
Add test for `--full-page` flag parsing in `commands.test.ts`:

1. Add a new describe block after the `--no-open` tests (or in a logical location):
   ```typescript
   describe('--full-page option', () => {
     it('parses --full-page flag', () => {
       program.parse(['node', 'cli', 'http://localhost', '--full-page']);
       expect(program.opts().fullPage).toBe(true);
     });

     it('fullPage is undefined when not specified', () => {
       program.parse(['node', 'cli', 'http://localhost']);
       expect(program.opts().fullPage).toBeUndefined();
     });
   });
   ```

2. Update the "combined options" test to include --full-page:
   ```typescript
   // Add to the parse array:
   '--full-page',
   // Add to expectations:
   expect(program.opts().fullPage).toBe(true);
   ```
  </action>
  <verify>`npm test -- src/cli/__tests__/commands.test.ts` - all tests pass</verify>
  <done>Tests verify --full-page parses to true when present, undefined when absent</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. All CLI tests pass: `npm test -- src/cli/__tests__/commands.test.ts`
3. Help shows new flag: `npx tsx src/cli/index.ts --help | grep full-page`
</verification>

<success_criteria>
- CaptureOptions interface has `fullPage?: boolean` with JSDoc
- CLIOptions interface has `fullPage?: boolean` with JSDoc
- Commander program has `--full-page` option defined
- Help text includes --full-page with description and example
- Tests verify flag parsing behavior
- TypeScript compiles successfully
</success_criteria>

<output>
After completion, create `.planning/phases/21-capture-engine-changes/21-01-SUMMARY.md`
</output>
