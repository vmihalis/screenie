---
phase: 10-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/cli/types.ts
  - src/cli/commands.ts
  - src/cli/actions.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Report opens in default browser after successful capture"
    - "User can suppress auto-open with --no-open flag"
    - "Exit code 0 on success, non-zero on failure"
  artifacts:
    - path: "package.json"
      provides: "open dependency"
      contains: "open"
    - path: "src/cli/types.ts"
      provides: "noOpen option type"
      contains: "noOpen"
    - path: "src/cli/commands.ts"
      provides: "--no-open flag definition"
      contains: "no-open"
    - path: "src/cli/actions.ts"
      provides: "open() call after report generation"
      contains: "import open"
  key_links:
    - from: "src/cli/actions.ts"
      to: "open package"
      via: "import and call after generateReport"
      pattern: "await open\\(reportPath\\)"
    - from: "src/cli/commands.ts"
      to: "src/cli/types.ts"
      via: "noOpen option parsed"
      pattern: "noOpen"
---

<objective>
Implement auto-open report feature (OUT-06) with opt-out flag

Purpose: Complete the last v1 requirement - automatically open the HTML report in the user's default browser after capture completes
Output: Working auto-open feature with --no-open flag for CI/headless environments
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-integration/10-RESEARCH.md

# Key files to modify
@src/cli/actions.ts
@src/cli/commands.ts
@src/cli/types.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install open package and update types</name>
  <files>package.json, src/cli/types.ts</files>
  <action>
    1. Install `open` package (ESM-only, cross-platform browser opener):
       ```bash
       npm install open
       ```

    2. Update src/cli/types.ts - add noOpen option to CLIOptions interface:
       ```typescript
       /** Suppress auto-open of report in browser */
       noOpen?: boolean;
       ```

    IMPORTANT: The open package is ESM-only (v10+), which matches our project's ESM setup.
  </action>
  <verify>
    - npm ls open shows open@^11.x installed
    - grep "noOpen" src/cli/types.ts returns the new property
  </verify>
  <done>
    - open package in dependencies
    - CLIOptions interface includes noOpen?: boolean
  </done>
</task>

<task type="auto">
  <name>Task 2: Add --no-open flag to Commander</name>
  <files>src/cli/commands.ts</files>
  <action>
    Add --no-open flag to the Commander program in createProgram():

    After the --output option and before .addHelpText(), add:
    ```typescript
    // Browser auto-open control
    .option('--no-open', 'Suppress auto-opening report in browser')
    ```

    Note: Commander's --no-* prefix creates a boolean that defaults to true (open=true),
    and --no-open sets it to false. This means:
    - Default behavior: report opens (noOpen will be false/undefined)
    - With --no-open: report doesn't open (noOpen will be true)

    Wait, that's backwards. Commander's --no-* prefix means:
    - --no-open sets options.open = false
    - Without flag, options.open = undefined (not true!)

    Better approach: Use explicit --no-open flag:
    ```typescript
    .option('--no-open', 'Suppress auto-opening report in browser')
    ```
    This creates options.open (not noOpen). When --no-open is passed, open = false.
    When not passed, open = undefined.

    In actions.ts, we'll check: if options.open !== false, call open().

    Update the help examples to show --no-open usage.
  </action>
  <verify>
    - node dist/cli.js --help shows --no-open option
    - grep "no-open" src/cli/commands.ts returns the option definition
  </verify>
  <done>
    - --no-open flag defined in Commander program
    - Help text shows the new option
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate open() call into actions.ts</name>
  <files>src/cli/actions.ts</files>
  <action>
    1. Add import at top of file:
       ```typescript
       import open from 'open';
       ```

    2. After the line `console.log(pc.green('\nReport saved: ${reportPath}'));` (line ~118),
       add the auto-open logic:
       ```typescript
       // Auto-open report in browser unless suppressed
       if (options.open !== false) {
         await open(reportPath);
       }
       ```

    3. Note: The options parameter comes from CLIOptions. Commander's --no-open flag
       sets options.open to false when present. If not present, options.open is undefined,
       so `options.open !== false` will be true, and we open the browser.

    IMPORTANT considerations from research:
    - open() is async but returns immediately after launching browser (doesn't wait for close)
    - Works with file paths directly, not just URLs
    - Cross-platform: uses xdg-open on Linux, open on macOS, start on Windows
    - No need for { wait: true } - we just want to launch and continue
  </action>
  <verify>
    - grep "import open" src/cli/actions.ts returns the import
    - grep "await open" src/cli/actions.ts returns the call
    - Build succeeds: npm run build
    - Manual test: npm run dev -- https://example.com --phones-only (should open report)
  </verify>
  <done>
    - open package imported in actions.ts
    - Auto-open called after report generation
    - --no-open flag respected (skips open when flag present)
    - Build passes with no TypeScript errors
  </done>
</task>

</tasks>

<verification>
1. Build verification:
   ```bash
   npm run build
   ```
   Should complete without errors.

2. Feature verification (manual):
   ```bash
   npm run dev -- https://example.com --phones-only
   ```
   Should:
   - Complete capture
   - Print "Report saved: /path/to/report.html"
   - Open report in default browser automatically

3. Flag verification (manual):
   ```bash
   npm run dev -- https://example.com --phones-only --no-open
   ```
   Should:
   - Complete capture
   - Print "Report saved: /path/to/report.html"
   - NOT open browser (no auto-open)

4. Help verification:
   ```bash
   npm run dev -- --help
   ```
   Should show --no-open option in help output.
</verification>

<success_criteria>
1. OUT-06 requirement satisfied: Report opens automatically after capture
2. --no-open flag works for CI/headless environments
3. npm run build passes without errors
4. No breaking changes to existing CLI behavior
</success_criteria>

<output>
After completion, create `.planning/phases/10-integration/10-01-SUMMARY.md`
</output>
